-- test with user-defined aggregate
uda LogicalAvg(x) {
  init: [0 as _sum, 0 as _count];
  update: [_sum + x, _count + 1];
  emit: _sum / _count;
};
uda LocalAvg(x) {
  init: [0 as _sum, 0 as _count];
  update: [_sum + x, _count + 1];
};
uda RemoteAvg(_local_sum, _local_count) {
  init: [0 as _sum, 0 as _count];
  update: [_sum + _local_sum, _count + _local_count];
  emit: [_sum/_count];
};
uda* LogicalAvg {LocalAvg, RemoteAvg};

out = [FROM SCAN(public:adhoc:employee) AS X EMIT dept_id,
       LogicalAvg(salary) + LogicalAvg($0)];
STORE(out, OUTPUT);
